SS:得分

ss:校验和

12-12: 12字节输入 12字节返回



# 1.录入图像: PS_GetImage   

`EF 01 FF FF FF FF 01 00 03 01 00 05`
功能说明: 探测手指，探测到后录入指纹图像存于 ImageBuffer。返回确认码表示：录入成功、无手指等。
12-12



# 2.生成特性: PS_GenChar

`EF 01 FF FF FF FF 01 00 04 02 01 00 08`

`EF 01 FF FF FF FF 01 00 04 02 02 00 09`

功能说明: 将 ImageBuffer 中的原始图像生成指纹特征文件存于 CharBuffer1 或 CharBuffer2

13-12



# 3.精确比对两枚指纹特征: PS_Match

`EF 01 FF FF FF FF 01 00 03 03 00 07`

功能说明: 精确比对 CharBuffer1 与 CharBuffer2 中的特征文件

12-14



# 4.搜索指纹 PS_Search

`EF 01 FF FF FF FF 01 00 08 04 x1 x2 x2 x3 x3 ss ss`

功能说明: 以 CharBuffer1 或 CharBuffer2 中的特征文件搜索整个或部分指纹库。若搜索到，则返回页码。

17-16



# 5.合并特征（生成模板） PS_RegModel

`EF 01 FF FF FF FF 01 00 03 05 00 09`

功能说明： 将 CharBuffer1 与 CharBuffer2 中的特征文件合并生成模板，结果存于 CharBuffer1 与 CharBuffer2。

12-12

# 6.储存模板 PS_StoreChar

`EF 01 FF FF FF FF 01 00 06 06 01 x1 x2 ss ss`

`EF 01 FF FF FF FF 01 00 06 06 02 x1 x2 ss ss`

x1, x2: 位置号

功能说明： 将 CharBuffer1 或 CharBuffer2 中的模板文件存到 PageID 号 flash 数据库位置。

15-12

# 7.读出模板 PS_LoadChar

`EF 01 FF FF FF FF 01 00 06 07 01 x1 x2 ss ss`

`EF 01 FF FF FF FF 01 00 06 07 02 x1 x2 ss ss`

x1 x2 :  ID 号

功能说明： 将 flash 数据库中指定 ID 号的指纹模板读入到模板缓冲区 CharBuffer1 或 CharBuffer2

15-12

# 8.上传特征或模板 PS_UpChar

`EF 01 FF FF FF FF 01 00 04 08 01 00 0E`

`EF 01 FF FF FF FF 01 00 04 08 02 00 0F`

功能说明： 将CharBuffer1 或 CharBuffer2 (特征缓冲区) 中的特征文件上传给上位机  

13-12

# 9.下载特征或模板 PS_DownChar

`EF 01 FF FF FF FF 01 00 04 09 01 00 0F`

`EF 01 FF FF FF FF 01 00 04 09 02 00 10`

功能说明： 上位机下载特征文件到模块的一个特征缓冲区(CharBuffer1 或 CharBuffer2 中)

13-12

# 10.上传图像 PS_UpImage

`EF 01 FF FF FF FF 01 00 03 0A 00 0E`

功能说明： 将图像缓冲区中的数据上传给上位机  

12-12

# 11.下载图像 PS_DownImage

`EF 01 FF FF FF FF 01 00 03 0B 00 0E`

功能说明： 上位机下载图像数据给模块  

12-12

# 12.删除模板 PS_DeletChar

`EF 01 FF FF FF FF 01 00 07 0C x1 x2 n1 n2 ss ss`

x1 x2: 指定的 ID 号

n1 n2: 删除个数

功能说明： 删除 flash 数据库中指定 ID 号开始的 N 个指纹模板  

16-12

# 13.清空指纹库 PS_Empty

`EF 01 FF FF FF FF 01 00 03 0D 00 11`

功能说明： 删除 flash 数据库中所有指纹模板  

12-12

# 14.写系统寄存器 PS_WriteReg

`EF 01 FF FF FF FF 01 00 05 0E r1 t1 ss ss`

r1: 寄存器序号(04/05/06, 三选一)

t1: 内容

| 寄存器号 |    寄存器名称    |                     内容说明                      |
| :------: | :--------------: | :-----------------------------------------------: |
|    4     | 波特率控制寄存器 |                   9600 的倍数 N                   |
|    5     |  比对阀值寄存器  | 1：level1 2：level2 3：level3 4：level4 5：level5 |
|    6     |   包大小寄存器   |   0：32bytes 1：64bytes 2：128bytes 3：256bytes   |

14-12

# 15.读系统基本参数 PS_ReadSysPara

`EF 01 FF FF FF FF 01 00 03 0F 00 13`

读取模块的基本参数（波特率，包大小等）

12-(9+3+16)

# 16.自动注册模板 PS_Enroll

`EF 01 FF FF FF FF 01 00 03 10 00 14`

功能说明： 采集一次指纹注册模板，在指纹库中搜索空位并存储，返回存储ID

12-14

# 17.自动验证指纹 PS_Identify

功能说明：

- 自动采集指纹，在指纹库中搜索目标模板并返回搜索结果。

- 如果目标模板同当前采集的指纹比对得分大于最高阀值，并且目标模板为不完整特征则以采集的特征更新目标模板的空白区域。

`EF 01 FF FF FF FF 01 00 03 11 00 15`

12-16

# 18.设置口令 PS_SetPwd

> ⚠️: 口令和地址一旦修改就和上位机通讯不成功，口令忘记了就无法找回了。 模块只能变成砖头了！  

功能说明： 设置模块握手口令  

16-12

# 19.验证口令 PS_VfyPwd

功能说明： 验证模块握手口令  

16-12

# 20.采样随机数 PS_GetRandomCode

`EF 01 FF FF FF FF 01 00 03 14 00 18`

功能说明： 令芯片生成一个随机数并返回给上位机  

12-16

# 21.设置芯片地址 PS_SetChipAddr

> ⚠️: 口令和地址一旦修改就和上位机通讯不成功，口令忘记了就无法找回了。 模块只能变成砖头了！ 

功能说明： 设置芯片地址  

16-16

# 22.读 flash 信息页 PS_ReadINFpage

`EF 01 FF FF FF FF 01 00 03 16 00 1a`

功能说明： 读取 FLASH Information Page 所在的信息页(512bytes)  

12-12

# 23.端口控制 PS_Port_Control

13-12

# 24.写记事本 PS_WriteNotepad

| 2 bytes |  4bytes  | 1 byte | 2 bytes | 1 byte | 1byte | 32 bytes | 2 bytes |
| :-----: | :------: | :----: | :-----: | :----: | :---: | :------: | :-----: |
|  包头   | 芯片地址 | 包标识 | 包长度  | 指令码 | 页码  | 用户信息 | 校验和  |
| 0xEF01  |   xxxx   |  01H   |   36    |  18H   | 0~15  | content  |   sum   |

功能说明： 模块内部为用户开辟了 256bytes 的 FLASH 空间用于存放用户数据，该存储空间称为用户记事本，该记事本逻辑上被分成 16 个页，写记事本命令用于写入用户的 32bytes 数据到指定的记事本页。

(9+36)-12

# 25.读记事本 PS_ReadNotepad

| 2 bytes | 4bytes   | 1 byte | 2 bytes | 1 byte | 1byte | 2 bytes |
| ------- | -------- | ------ | ------- | ------ | ----- | ------- |
| 包头    | 芯片地址 | 包标识 | 包长度  | 指令码 | 页码  | 校验和  |
| 0xEF01  | xxxx     | 01H    | 04H     | 19H    | 0~15  | xxH     |

读取 FLASH 用户区的 128bytes 数据  

13-(9+3+32)

# 26.烧写片内 FLASH PS_ BurnCode

13-12

# 27.高速搜索 PS_HighSpeedSearch

| 2 bytes | 4bytes   | 1 byte | 2 bytes | 1 byte | 1 byte   | 2 bytes   | 2 bytes | 2 bytes |
| ------- | -------- | ------ | ------- | ------ | -------- | --------- | ------- | ------- |
| 包头    | 芯片地址 | 包标识 | 包长度  | 指令码 | 缓冲区号 | 参数      | 参数    | 校验和  |
| 0xEF01  | xxxx     | 01H    | 08H     | 1bH    | BufferID | StartPage | PageNum | sum     |

功能说明：

- 以 CharBuffer1 或 CharBuffer2 中的特征文件高速搜索整个或部分指纹库。若搜索到，则返回页码。

- 该指令对于的确存在于指纹库中，且登录时质量很好的指纹，会很快给出搜索结果。

17-16

# 28.生成细化指纹图像 PS1_GenBinImage

功能说明： 对图像缓冲区中的指纹图像进行处理并生成细化指纹图像  

| 2 bytes | 4bytes   | 1 byte | 2 bytes | 1 byte | 1 bytes  | 2 bytes |
| ------- | -------- | ------ | ------- | ------ | -------- | ------- |
| 包头    | 芯片地址 | 包标识 | 包长度  | 指令码 | 目标类型 | 校验和  |
| 0xEF01  | xxxx     | 01H    | 04H     | 1cH    | 0/1/2    | sum     |

目标类型:

- 0：二值化图像

- 1：不含特征点标识的细化图像

- 2 或其他：带有特征点标识的细化图像

13-12

# 29.读有效模板个数 PS_ValidTempleteNum

`EF 01 FF FF FF FF 01 00 03 1D 00 21`

12-14





# 确认码:

00h：表示指令执行完毕或 OK；

01h：表示数据包接收错误；

02h：表示传感器上没有手指；

03h：表示录入指纹图像失败；

04h：表示指纹图像太干、太淡而生不成特征；

05h：表示指纹图像太湿、太糊而生不成特征；

06h：表示指纹图像太乱而生不成特征；

07h：表示指纹图像正常，但特征点太少（或面积太小）而生不成特征；

08h：表示指纹不匹配；

09h：表示没搜索到指纹；

0ah：表示特征合并失败；

0bh：表示访问指纹库时地址序号超出指纹库范围；

0ch：表示从指纹库读模板出错或无效；

0dh：表示上传特征失败；

0eh：表示模块不能接受后续数据包；

0fh：表示上传图像失败；

10h：表示删除模板失败；

11h：表示清空指纹库失败；

12h：表示不能进入低功耗状态；

13h：表示口令不正确；

14h：表示系统复位失败；

15H：表示缓冲区内没有有效原始图而生不成图像；

16H：表示在线升级失败；

17H：表示残留指纹或两次采集之间手指没有移动过；

18H：表示读写 FLASH 出错；

0xf0：有后续数据包的指令，正确接收后用 0xf0 应答；

0xf1：有后续数据包的指令，命令包用 0xf1 应答；

0xf2：表示烧写内部 FLASH 时，校验和错误；

0xf3：表示烧写内部 FLASH 时，包标识错误；

0xf4：表示烧写内部 FLASH 时，包长度错误；

0xf5：表示烧写内部 FLASH 时，代码长度太长；

0xf6：表示烧写内部 FLASH 时，烧写 FLASH 失败；

0x19：未定义错误；

0x1a：无效寄存器号；

0x1b：寄存器设定内容错误号；

0x1c：记事本页码指定错误；

0x1d：端口操作失败；

0x1e：自动注册（enroll）失败；

0x1f：指纹库满

