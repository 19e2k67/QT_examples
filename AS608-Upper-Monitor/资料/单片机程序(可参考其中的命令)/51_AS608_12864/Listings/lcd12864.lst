C51 COMPILER V9.57.0.0   LCD12864                                                          10/20/2023 15:06:29 PAGE 1   


C51 COMPILER V9.57.0.0, COMPILATION OF MODULE LCD12864
OBJECT MODULE PLACED IN .\Objects\lcd12864.obj
COMPILER INVOKED BY: F:\keil5\keil\C51\BIN\C51.EXE app\lcd12864.c OPTIMIZE(8,SPEED) BROWSE INCDIR(.\App;.\Public) DEBUG 
                    -OBJECTEXTEND PRINT(.\Listings\lcd12864.lst) OBJECT(.\Objects\lcd12864.obj)

line level    source

   1          #include "lcd12864.h"
   2          char local_date=0;
   3          //LCD初始化
   4          void lcd12864_init(void)
   5          {
   6   1              LCD12864_PSB = 1; //选择8位或4位并口方式
   7   1              lcd12864_write_cmd(0x30);        //显示模式设置，开始要求每次检测忙信号
   8   1              lcd12864_write_cmd(0x01);        //显示清屏
   9   1              lcd12864_write_cmd(0x06);        //显示光标移动设置
  10   1              lcd12864_write_cmd(0x0C);        //显示开及光标设置
  11   1      
  12   1      }
  13          
  14          //写指令
  15          void lcd12864_write_cmd(u8 cmd)
  16          {
  17   1      
  18   1              LCD12864_RS = 0;
  19   1              LCD12864_WR = 0;
  20   1              LCD12864_E = 0;
  21   1              LCD12864_DATAPORT = cmd;
  22   1              delay_ms(1);
  23   1              LCD12864_E = 1;
  24   1              delay_ms(1);
  25   1              LCD12864_E = 0;
  26   1      }
  27          
  28          //写数据
  29          void lcd12864_write_data(u8 dat)
  30          {
  31   1      
  32   1              LCD12864_RS = 1;
  33   1              LCD12864_WR = 0;
  34   1              LCD12864_E = 0;
  35   1              LCD12864_DATAPORT = dat;
  36   1              delay_ms(1);
  37   1              LCD12864_E = 1;
  38   1              delay_ms(1);
  39   1              LCD12864_E = 0;
  40   1      }
  41          
  42          //清屏
  43          void lcd12864_clear(void)
  44          {
  45   1              lcd12864_write_cmd(0x01);        //显示清屏
  46   1      }
  47          
  48          /*******************************************************************************
  49          * 函 数 名       : lcd12864_show_char
  50          * 函数功能               : LCD12864显示一个字符
  51          * 输    入       : x,y：显示坐标，x=0~7，y=0~3;
  52                                             DData：显示的字符
  53          * 输    出       : 无
  54          *******************************************************************************/
C51 COMPILER V9.57.0.0   LCD12864                                                          10/20/2023 15:06:29 PAGE 2   

  55          void lcd12864_show_char(u8 X, u8 Y, u8 DData)
  56          {
  57   1              if(Y<=0)Y=0;
  58   1              if(Y>3)Y=3;
  59   1              X &= 0x0F;      //限制X不能大于16，Y不能大于1
  60   1              switch (Y) {
  61   2                      case 0:
  62   2                              X |= 0x80;
  63   2                              break;
  64   2                      case 1:
  65   2                              X |= 0x90;
  66   2                              break;
  67   2                      case 2:
  68   2                              X |= 0x88;
  69   2                              break;
  70   2                      case 3:
  71   2                              X |= 0x98;
  72   2                              break;
  73   2              }
  74   1      
  75   1              lcd12864_write_cmd(X);      //这里不检测忙信号，发送地址码
  76   1              lcd12864_write_data(DData);
  77   1      }
  78          
  79          /*******************************************************************************
  80          * 函 数 名       : lcd12864_show_string
  81          * 函数功能               : LCD12864显示字符串
  82          * 输    入       : x,y：显示坐标，x=0~7，y=0~3;
  83                                             DData：显示字符串数据
  84          * 输    出       : 无
  85          *******************************************************************************/
  86          void lcd12864_show_string(u8 X, u8 Y, u8 *DData)
  87          {
  88   1              u8 ListLength, X2;
  89   1              ListLength = 0;
  90   1              X2 = X;
  91   1              if(Y<=0)Y=0;
  92   1              if(Y>3)Y=3;
  93   1              X &= 0x0F;      //限制X不能大于16，Y在1-4之内
  94   1              switch (Y) {
  95   2                      case 0:
  96   2                              X2 |= 0x80;
  97   2                              break;
  98   2                      case 1:
  99   2                              X2 |= 0x90;
 100   2                              break;
 101   2                      case 2:
 102   2                              X2 |= 0x88;
 103   2                              break;
 104   2                      case 3:
 105   2                              X2 |= 0x98;
 106   2                              break;
 107   2              }
 108   1              lcd12864_write_cmd(X2);     //发送地址码
 109   1              while (DData[ListLength] >= 0x20) { //若到达字串尾则退出
 110   2                      if (X <= 0x0F) { //X坐标应小于0x0F
 111   3                              lcd12864_write_data(DData[ListLength]);
 112   3                              ListLength++;
 113   3                              X++;
 114   3                              delay_ms(5);
 115   3                      }
 116   2              }
C51 COMPILER V9.57.0.0   LCD12864                                                          10/20/2023 15:06:29 PAGE 3   

 117   1      }
 118          
 119          
 120          
 121          
 122          /*******************************************************************************
 123          * 函 数 名       : lcd12864_show_num
 124          * 函数功能               : LCD12864显示数字
 125          * 输    入       : x,y：显示坐标，x=0~7，y=0~3;
 126                                             number：显示字符串数据
 127                             Length：要显示数字的长度
 128          * 输    出       : 无
 129          *******************************************************************************/
 130          
 131          void lcd12864_show_num(u8 X, u8 Y, u32 number, u8 Length)
 132          {
 133   1              u8 array[11];
 134   1              u8 i;
 135   1              array[Length] = 0;
 136   1        
 137   1          
 138   1              for (i = Length; i > 0; i--) {
 139   2                      array[i - 1] = number % 10 + '0';
 140   2                      number /= 10;
 141   2              }
 142   1      
 143   1              for (i = 0; i < Length - 1; i++) {
 144   2                      if (array[i] == '0') {
 145   3                              array[i] = ' ';
 146   3                      }
 147   2                      else {
 148   3                              break;
 149   3                      }
 150   2              }
 151   1              lcd12864_show_string(X, Y, array);
 152   1      }
 153          
 154          /*******************************************************************************
 155          * 函 数 名       : lcd12864_show_image
 156          * 函数功能               : LCD12864显示图片
 157          * 输    入       : DData：要显示的图片
 158                              阴码，顺向（高位在前），逐行
 159          * 输    出       : 无
 160          *******************************************************************************/
 161          
 162          void lcd12864_show_image(u8 code *DData)
 163          {
 164   1          u8 x, y, i;
 165   1          u16 tmp = 0;
 166   1          for(i = 0; i < 9; i+=8)     //分两屏，上半屏和下半屏
 167   1          {
 168   2              for(x=0; x<32; x++)
 169   2              {
 170   3                  lcd12864_write_cmd(0x34);
 171   3                  lcd12864_write_cmd(0x80+x);      //列地址
 172   3                  lcd12864_write_cmd(0x80+i);      //行地址，下半屏
 173   3                  for(y=0;y<16;y++)
 174   3                  {
 175   4                      lcd12864_write_data(DData[tmp+y]); //读取数据写入LCD
 176   4                  }
 177   3                  tmp +=16;
 178   3              }
C51 COMPILER V9.57.0.0   LCD12864                                                          10/20/2023 15:06:29 PAGE 4   

 179   2          }
 180   1          lcd12864_write_cmd(0x36);        //扩充功能设定
 181   1          lcd12864_write_cmd(0x30);
 182   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    490    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      1      32
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
